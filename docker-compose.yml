version: "3.2"

services: 
    # http://localhost:8080/
    cli:
        build: ./cli
        image: devops/letsencrypt-docker-compose-cli
        user: ${CURRENT_USER}
        group_add:
        - ${DOCKER_GROUP}
        environment:
        - COMPOSE_PROJECT_NAME
        - CURRENT_USER
        - DOCKER_GROUP
        volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - ./:/workdir
        profiles:
        - config
    webapp :
        image: jetty:10.0.17-jdk11
        ports: 
        - "8080:8080"
        volumes:
        - ./target/spring-boot-leaflet-starter-0.0.1-SNAPSHOT.war:/var/lib/jetty/webapps/root.war
    nginx:
        image: nginx:1.15-alpine
        ports:
        - "80:80"
        - "443:443"
        volumes:
        - ./data/nginx:/etc/nginx/conf.d
        - ./data/certbot/conf:/etc/letsencrypt
        - ./data/certbot/www:/var/www/certbot
    certbot:
        image: certbot/certbot
        volumes:
        - ./data/certbot/conf:/etc/letsencrypt
        - ./data/certbot/www:/var/www/certbot
    
    
